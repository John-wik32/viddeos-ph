<script>
async function upload() {
  const file = document.getElementById('file').files[0];
  const title = document.getElementById('title').value;
  const tags = document.getElementById('tags').value;
  const btn = document.getElementById('upBtn');

  if (!file || !title) {
    alert("Missing title or video file");
    return;
  }

  btn.innerText = "Uploading...";
  btn.disabled = true;

  const formData = new FormData();
  formData.append("file", file);
  formData.append("upload_preset", "public_videos"); // âœ… PRESET NAME

  const response = await fetch(
    "https://api.cloudinary.com/v1_1/public_videos/video/upload",
    {
      method: "POST",
      body: formData
    }
  );

  const data = await response.json();

  if (!data.secure_url) {
    alert("Upload failed. Check Cloudinary settings.");
    btn.innerText = "Upload";
    btn.disabled = false;
    return;
  }

  videoDB.get(Math.random().toString(36).slice(2)).put({
    title: title,
    tags: tags,
    url: data.secure_url,
    time: Date.now()
  });

  btn.innerText = "Uploaded!";
  btn.disabled = false;
}
</script>
